var slot1 = [{"from":"2019-11-26T00:00:00.000Z","name":"Sagrada Reset","picture":"sagrada-reset"},{"from":"2020-03-03T00:00:00.000Z","name":"The Great Passage","picture":"great-passage"}];
var slot2 = [{"from":"2019-01-08T00:00:00.000Z","name":"Hunter &times; Hunter","picture":"hunter-x-hunter"}];
var slot3 = [{"from":"2020-01-07T00:00:00.000Z","name":"Slow Start","picture":"slow-start"},{"from":"2020-02-18T00:00:00.000Z","name":"Kaguya-sama, Love is War","picture":"kaguya-sama"}];

var events = [{"name":"Overwatch League","date":"2020-02-08T00:00:00.000Z","class":"esports","dateLong":"Saturday, 8 February 2020","day":8,"month":"Feb","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-02-11T19:00:00.000Z","dateLong":"Tuesday, 11 February 2020","day":11,"month":"Feb","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-02-18T19:00:00.000Z","dateLong":"Tuesday, 18 February 2020","day":18,"month":"Feb","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-02-25T19:00:00.000Z","dateLong":"Tuesday, 25 February 2020","day":25,"month":"Feb","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"name":"My Hero Academia: Heroes Rising","date":"2020-02-26T00:00:00.000Z","class":"cinema","venue":"Vue Festival Place, Odeon Basingstoke","dateLong":"Wednesday, 26 February 2020","day":26,"month":"Feb"},{"date":"2020-03-03T19:00:00.000Z","dateLong":"Tuesday, 3 March 2020","day":3,"month":"Mar","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-03-10T19:00:00.000Z","dateLong":"Tuesday, 10 March 2020","day":10,"month":"Mar","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-03-17T19:00:00.000Z","dateLong":"Tuesday, 17 March 2020","day":17,"month":"Mar","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-03-24T19:00:00.000Z","dateLong":"Tuesday, 24 March 2020","day":24,"month":"Mar","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-03-31T18:00:00.000Z","dateLong":"Tuesday, 31 March 2020","day":31,"month":"Mar","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-04-07T18:00:00.000Z","dateLong":"Tuesday, 7 April 2020","day":7,"month":"Apr","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-04-14T18:00:00.000Z","dateLong":"Tuesday, 14 April 2020","day":14,"month":"Apr","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-04-21T18:00:00.000Z","dateLong":"Tuesday, 21 April 2020","day":21,"month":"Apr","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-04-28T18:00:00.000Z","dateLong":"Tuesday, 28 April 2020","day":28,"month":"Apr","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-05-05T18:00:00.000Z","dateLong":"Tuesday, 5 May 2020","day":5,"month":"May","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-05-12T18:00:00.000Z","dateLong":"Tuesday, 12 May 2020","day":12,"month":"May","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-05-19T18:00:00.000Z","dateLong":"Tuesday, 19 May 2020","day":19,"month":"May","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-05-26T18:00:00.000Z","dateLong":"Tuesday, 26 May 2020","day":26,"month":"May","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-06-02T18:00:00.000Z","dateLong":"Tuesday, 2 June 2020","day":2,"month":"Jun","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-06-09T18:00:00.000Z","dateLong":"Tuesday, 9 June 2020","day":9,"month":"Jun","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-06-16T18:00:00.000Z","dateLong":"Tuesday, 16 June 2020","day":16,"month":"Jun","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-06-23T18:00:00.000Z","dateLong":"Tuesday, 23 June 2020","day":23,"month":"Jun","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-06-30T18:00:00.000Z","dateLong":"Tuesday, 30 June 2020","day":30,"month":"Jun","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-07-07T18:00:00.000Z","dateLong":"Tuesday, 7 July 2020","day":7,"month":"Jul","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-07-14T18:00:00.000Z","dateLong":"Tuesday, 14 July 2020","day":14,"month":"Jul","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-07-21T18:00:00.000Z","dateLong":"Tuesday, 21 July 2020","day":21,"month":"Jul","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-07-28T18:00:00.000Z","dateLong":"Tuesday, 28 July 2020","day":28,"month":"Jul","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-08-04T18:00:00.000Z","dateLong":"Tuesday, 4 August 2020","day":4,"month":"Aug","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-08-11T18:00:00.000Z","dateLong":"Tuesday, 11 August 2020","day":11,"month":"Aug","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-08-18T18:00:00.000Z","dateLong":"Tuesday, 18 August 2020","day":18,"month":"Aug","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-08-25T18:00:00.000Z","dateLong":"Tuesday, 25 August 2020","day":25,"month":"Aug","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"date":"2020-09-01T18:00:00.000Z","dateLong":"Tuesday, 1 September 2020","day":1,"month":"Sep","name":"Anime Society Meeting","class":"anime","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"name":"No Meeting","date":"2020-12-22T00:00:00.000Z","class":"skip","dateLong":"Tuesday, 22 December 2020","day":22,"month":"Dec","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"},{"name":"No Meeting","date":"2020-12-29T00:00:00.000Z","class":"skip","dateLong":"Tuesday, 29 December 2020","day":29,"month":"Dec","venue":"The White Hart","address":"London Road, Basingstoke RG21 4AE"}];

// select a background image
function selectBackground() {
    var LIMIT = 3;

    var hour = new Date().getHours();
    var isDay = hour >= 6 && hour < 18;
    var bgNum = 1+Math.floor(Math.random() * LIMIT);
    var bodyClass = (isDay ? "day day-" : "night night-")+bgNum;

    document.getElementsByTagName("BODY")[0].className = bodyClass;
}

window.onload = function () {
  var now = new Date(Date.now());

  // adjust the showing anime
  function showingAnime(slot) {
    var before = slot.filter(function (series) {
      return Date.parse(series.from) < now;
    });
    return before[before.length - 1];
  }

  var currentSlot1 = showingAnime(slot1);
  var currentSlot2 = showingAnime(slot2);
  var currentSlot3 = showingAnime(slot3);

  function editSlot(id, series) {
    document.getElementById(id+'name').innerHTML = series.name;
    document.getElementById(id+'picture').setAttribute('src', 'images/series/'+series.picture+'.png');
  }

  editSlot('slot1', currentSlot1);
  editSlot('slot2', currentSlot2);
  editSlot('slot3', currentSlot3);

  // adjust the events list
  events = events.filter(function (event) {
    return Date.parse(event.date) >= now;
  });
  events = events.slice(0, 8);
  var nextEvent = events[0];

  var eventsHTML = '';
  var event;
  for (event of events) {
    var html = "<article id='upcoming-"+event.date+"' class='event event-"+event.class+"'>\n"+
      "<time datetime='"+event.date+"'><span class='day'>"+event.day+"</span><span class='month'>"+event.month+"</span></time>\n"+
      "<h3>"+event.name+"</h3>\n"+
      "<p>"+event.venue+"</h3>\n"+
      "</article>\n";
    eventsHTML = eventsHTML + html;
  }
  document.getElementById('events-list').innerHTML = eventsHTML;

  // adjust the next event headline
  var mainEvents = events.filter(function (event) {
    switch (event.class) {
      case 'esports':
      case 'cinema':
      case 'skip':
        return false;

      default:
        return true;
    }
  });
  var nextEvent = mainEvents[0];
  document.getElementById('next-meeting-date').innerHTML = nextEvent.dateLong;
  document.getElementById('next-meeting-title').innerHTML = (nextEvent.name == 'Anime Society Meeting' ? '' : nextEvent.name);
  document.getElementById('next-meeting-venue').innerHTML = nextEvent.venue;
  document.getElementById('next-meeting-address').innerHTML = nextEvent.address;

  selectBackground();
};
setInterval(selectBackground, 300000); // 5 minutes

function showMap() {
  document.getElementById('blanket').className = "hide";
  document.getElementById('map-overlay').className = "hide";
  setTimeout(() => {
    document.getElementById('blanket').className = "show";
    document.getElementById('map-overlay').className = "show";
  }, 1);
}

function hideMap() {
  document.getElementById('blanket').className = "hide";
  document.getElementById('map-overlay').className = "hide";
  setTimeout(() => {
    document.getElementById('blanket').className = "";
    document.getElementById('map-overlay').className = "";
  }, 500);
}
